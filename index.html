<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Gorilla Hub</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
/* === BASIC RESET & THEME === */
:root {
  --bg: #121212;
  --text: #ffffff;
  --accent: #ff9800;
}
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: var(--bg);
  color: var(--text);
  transition: background 0.3s, color 0.3s;
}
header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: var(--accent);
  padding: 10px 20px;
}
header h1 { margin: 0; }
nav a {
  color: #fff;
  margin: 0 8px;
  text-decoration: none;
  font-weight: bold;
}
nav a:hover { text-decoration: underline; }
main { padding: 20px; }
.hidden { display: none; }
button {
  padding: 6px 12px;
  background: var(--accent);
  border: none;
  color: #fff;
  cursor: pointer;
}
input, select, textarea {
  padding: 6px;
  margin: 4px 0;
  width: 100%;
  box-sizing: border-box;
}
.card {
  background: #1e1e1e;
  padding: 15px;
  margin: 10px 0;
  border-radius: 6px;
}
@media (max-width: 600px) {
  nav { display: flex; flex-wrap: wrap; }
  nav a { flex: 1 1 50%; margin: 4px 0; }
}
</style>
</head>
<body>

<header>
  <h1>Gorilla Hub</h1>
  <nav>
    <a href="#" data-tab="home">Home</a>
    <a href="#" data-tab="tutorials">Tutorials</a>
    <a href="#" data-tab="cosmetics">Cosmetics</a>
    <a href="#" data-tab="ai-helper" id="ai-tab">AI Helper</a>
    <a href="#" data-tab="admin" id="admin-tab">Admin</a>
    <a href="#" data-tab="settings">Settings</a>
    <a href="#" data-tab="contact">Contact</a>
    <a href="#" data-tab="faq">FAQ</a>
    <a href="#" data-tab="terms">Terms</a>
    <a href="#" data-tab="privacy">Privacy</a>
    <a href="#" id="login-btn">Login</a>
  </nav>
</header>

<main>
  <!-- HOME -->
  <section id="home" class="tab-section">
    <h2>Welcome to Gorilla Hub</h2>
    <p id="home-text">Loading...</p>
  </section>

  <!-- TUTORIALS -->
  <section id="tutorials" class="tab-section hidden">
    <h2>Gorilla Tag Tutorials</h2>
    <div id="tutorials-content">Loading...</div>
  </section>

  <!-- COSMETICS -->
  <section id="cosmetics" class="tab-section hidden">
    <h2>Cosmetic Rarity Table</h2>
    <input type="text" id="cosmetic-search" placeholder="Search cosmetics...">
    <div id="cosmetics-list">Loading...</div>
  </section>

  <!-- AI HELPER -->
  <section id="ai-helper" class="tab-section hidden">
    <h2>AI Helper</h2>
    <div id="ai-chat"></div>
    <input type="text" id="ai-input" placeholder="Ask me anything...">
    <button id="ai-send">Send</button>
  </section>

  <!-- ADMIN -->
  <section id="admin" class="tab-section hidden">
    <h2>Admin Panel</h2>
    <div id="admin-content"></div>
  </section>

  <!-- SETTINGS -->
  <section id="settings" class="tab-section hidden">
    <h2>Settings</h2>
    <label>Dark Mode: <input type="checkbox" id="dark-toggle" checked></label>
    <label>Language: 
      <select id="lang-select">
        <option value="en">English</option>
        <option value="es">Espa√±ol</option>
      </select>
    </label>
    <label>Theme Color: <input type="color" id="theme-color" value="#ff9800"></label>
  </section>

  <!-- CONTACT -->
  <section id="contact" class="tab-section hidden">
    <h2>Contact Us</h2>
    <form action="https://formspree.io/f/xvgqdlkd" method="POST">
      <input type="text" name="name" placeholder="Name" required>
      <input type="email" name="_replyto" placeholder="Email" required>
      <textarea name="message" placeholder="Message" required></textarea>
      <button type="submit">Send</button>
    </form>
  </section>

  <!-- FAQ -->
  <section id="faq" class="tab-section hidden">
    <h2>FAQ</h2>
    <div id="faq-content">Loading...</div>
  </section>

  <!-- TERMS -->
  <section id="terms" class="tab-section hidden">
    <h2>Terms of Service</h2>
    <div id="terms-content">Loading...</div>
  </section>

  <!-- PRIVACY -->
  <section id="privacy" class="tab-section hidden">
    <h2>Privacy Policy</h2>
    <div id="privacy-content">Loading...</div>
  </section>
</main>

<!-- LOGIN MODAL -->
<div id="login-modal" class="hidden" style="position:fixed;top:0;left:0;width:100%;height:100%;background:#000000cc;display:flex;justify-content:center;align-items:center;">
  <div style="background:#1e1e1e;padding:20px;border-radius:8px;width:300px;">
    <h3>Login / Sign Up</h3>
    <input type="email" id="email" placeholder="Email">
    <input type="password" id="password" placeholder="Password">
    <button id="login-submit">Login</button>
    <button id="signup-submit">Sign Up</button>
    <button onclick="document.getElementById('login-modal').classList.add('hidden')">Close</button>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
<script>
let supabaseClient;
let currentUser = null;
let siteData = {};

async function initSupabase() {
  const res = await fetch('/api/config');
  const cfg = await res.json();
  supabaseClient = supabase.createClient(cfg.supabaseUrl, cfg.supabaseAnonKey);
  loadSiteContent();
}

async function loadSiteContent() {
  const { data, error } = await supabaseClient.from('site_content').select('*');
  if (!error) {
    siteData = {};
    data.forEach(row => siteData[row.section] = row.content);
    document.getElementById('home-text').innerText = siteData['home'] || '';
    document.getElementById('tutorials-content').innerText = siteData['tutorials'] || '';
    document.getElementById('cosmetics-list').innerText = siteData['cosmetics'] || '';
    document.getElementById('faq-content').innerText = siteData['faq'] || '';
    document.getElementById('terms-content').innerText = siteData['terms'] || '';
    document.getElementById('privacy-content').innerText = siteData['privacy'] || '';
  }
}

function switchTab(tab) {
  document.querySelectorAll('.tab-section').forEach(sec => sec.classList.add('hidden'));
  document.getElementById(tab).classList.remove('hidden');
}

document.querySelectorAll('nav a[data-tab]').forEach(a => {
  a.addEventListener('click', e => {
    e.preventDefault();
    switchTab(a.getAttribute('data-tab'));
  });
});

document.getElementById('login-btn').addEventListener('click', () => {
  document.getElementById('login-modal').classList.remove('hidden');
});

document.getElementById('login-submit').addEventListener('click', async () => {
  const email = document.getElementById('email').value;
  const password = document.getElementById('password').value;
  const { data, error } = await supabaseClient.auth.signInWithPassword({ email, password });
  if (!error) { currentUser = data.user; checkAdmin(); }
});

document.getElementById('signup-submit').addEventListener('click', async () => {
  const email = document.getElementById('email').value;
  const password = document.getElementById('password').value;
  await supabaseClient.auth.signUp({ email, password });
});

async function checkAdmin() {
  const { data } = await supabaseClient.from('users').select('role').eq('id', currentUser.id).single();
  if (data && (data.role === 'admin' || data.role === 'dev')) {
    document.getElementById('admin-tab').style.display = 'inline';
    loadAdminPanel();
  }
}

function loadAdminPanel() {
  const adminDiv = document.getElementById('admin-content');
  adminDiv.innerHTML = '';
  for (let sec in siteData) {
    const card = document.createElement('div');
    card.className = 'card';
    card.innerHTML = `<h4>${sec}</h4>
    <textarea id="edit-${sec}">${siteData[sec]}</textarea>
    <button onclick="updateSection('${sec}')">Save</button>`;
    adminDiv.appendChild(card);
  }
}

async function updateSection(sec) {
  const val = document.getElementById(`edit-${sec}`).value;
  await supabaseClient.from('site_content').update({ content: val }).eq('section', sec);
  siteData[sec] = val;
  loadSiteContent();
}

document.getElementById('ai-send').addEventListener('click', async () => {
  const msg = document.getElementById('ai-input').value;
  const chatDiv = document.getElementById('ai-chat');
  chatDiv.innerHTML += `<div>User: ${msg}</div>`;
  const res = await fetch('/api/ai', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ messages: [{ role: 'user', content: msg }] })
  });
  const data = await res.json();
  const reply = data.choices?.[0]?.message?.content || 'Error';
  chatDiv.innerHTML += `<div>AI: ${reply}</div>`;
});

document.getElementById('dark-toggle').addEventListener('change', e => {
  if (e.target.checked) {
    document.documentElement.style.setProperty('--bg', '#121212');
    document.documentElement.style.setProperty('--text', '#fff');
  } else {
    document.documentElement.style.setProperty('--bg', '#fff');
    document.documentElement.style.setProperty('--text', '#000');
  }
});

document.getElementById('theme-color').addEventListener('change', e => {
  document.documentElement.style.setProperty('--accent', e.target.value);
});

initSupabase();
</script>

</body>
</html>
